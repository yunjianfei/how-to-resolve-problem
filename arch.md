# 1. 引言

在[《关于架构的思考(二)——如何解决问题》][1]中，提到了以下观点：

- 学习的黄金圆环：what-how-why圆环
- 解决异常型问题：最主要的是找到“到底是谁的问题”（前提是先弄明白问题相关者的结构（链式/树形结构））
- 解决改善型问题：必须弄明白“核心目标”到底是什么，明确“利益相关者”以及其“权责”以及“真正关注的利益点”
- 关于人性：解决和人相关的问题，解决问题的人要做到“洞悉人性”和“反人性”    

----

前文提到过，软件架构是改善型问题中的一类，也是很大和很深的一门学问，本文尽量以"解决改善型问题"的角度来简要说明一个简单的软件架构过程，有表述不当的部分还请指正。


# 2. 什么是架构
前文我们多次提到过“架构”这个词，那么到底是什么是架构呢？

在 [《关于架构的思考(一)——什么是问题》][3]  中，我们提到：**架构是挖掘问题本质、解决问题的过程**

这个观点直接提出来还是比较唐突的，这里推荐一篇文章，我觉得讲的还是比较透彻的：[《架构漫谈（一）：什么是架构？》][2] 

本文引用如下一段总结：

    总结一下，什么是架构，就是     
    1. 根据要解决的问题，对目标系统的边界进行界定。
    2. 并对目标系统按某个原则的进行切分。切分的原则，要便于不同的角色，对切分出来的部分，并行或串行开展工作，一般并行才能减少时间。
    3. 并对这些切分出来的部分，设立沟通机制。
    4. 根据3，使得这些部分之间能够进行有机的联系，合并组装成为一个整体，完成目标系统的所有工作。

总结一下就是前文提到的：“**架构是挖掘问题本质、解决问题的过程**”，在第4章节中会详细以“解决改善型问题”的角度来说明一个典型的软件架构的过程。

# 3. 什么是软件

本文后面提及的架构均特指“软件架构”，那么什么是软件呢？

软件的起源可以追溯到“工业革命”，第一次工业革命以蒸汽机的大规模应用为标志。第二次工业革命以电力的广泛应用为标志。第三次工业革命，人类进入“科技时代”。我们熟知的冯诺依曼结构、图灵机的出现就是在20世纪初、中期，奠定了计算机基础。    

计算机的出现可以说是为了模拟人类、替代人类去做一些工作，甚至在某些方面超越人类（如AlphaGo战胜人类顶尖围棋高手李世石）。计算机是由硬件和软件组成的，硬件是软件运行的载体，而软件则是各种指令的组合（这里不详细讨论，可以参照计算机组成原理以及操作系统原理等）。

我们通常所说的软件，一般是应用软件，这些软件都是为了帮助人们解决问题。比如OA、ERP、财务类软件可以大大提升公司的管理、生产效率。

 ** 软件是人类社会中行为和现象的映射和载体，所有的软件都可以追溯到人类的实际行为。**

例如我们现在看到的工具类、财务类、社交类等软件，都可以找到相应的人类行为，软件的出现让人类社会更高效。

# 3. 开发软件的组织与软件架构

软件的开发者，可以是一个人也可以是一个组织。软件的规模越大，需要参与的开发者也越多，毕竟个人的力量始终有限。众多开发者形成一个组织，为了让这个组织高效的运行，一般都会形成“组织架构”。组织架构和软件架构是息息相关且不断演化的。

说到这里，我们很容易就想起大名鼎鼎的康威定律

    Organizations which design systems are constrained to produce designs which are copies of the communication structures of these organizations. - Melvin Conway(1967)    

翻译成中文就是：**设计系统的组织，其产生的设计(架构)等同于组织之内、组织之间的沟通结构**

看看下面这张图，在联想一下他们的产品设计(尤其是苹果的)，就能很形象的理解这句话。

<img src="http://img.blog.csdn.net/20171013144227268?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveXVuX2ppYW5mZWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" width="50%" height="50%">

因此，软件架构和组织架构是息息相关的，想要什么样的软件架构，就必须先有对应的组织架构。现在很火的微服务、devops之类的都符合康威定律。

# 4. 软件架构的思考

前文我们提到，软件架构也是改善型问题的一类，首先回顾一下改善型问题的定义：

    - 目标是将来去达到的
    - 现状没有达到目标

解决改善型问题需要明确以下三点：

    - what： 核心需求、目标是什么
    - who： 利益相关者有哪些，以及他们的权责以及关注的利益点
    - how： 利用有限的资源，权衡利益相关者，去满足关键利益点

很多情况下，软件架构会非常复杂，甚至会涉及到组织架构的调整。本文从“解决改善型问题”的角度来简要描述软件架构中的一些关键点，抛砖引玉，引起思考，如有纰漏之处还请多多指点、海涵。

---

通常软件开发的过程分为：需求分析、概要设计、详细设计、编码、测试、上线。软件架构一般涵盖了需求分析、概要设计、详细设计这几个部分。虽然说现在都是敏捷开发、快速迭代(devops)，但是也脱离不了这个过程。

需求分析、概要设计、详细设计的过程中，会有各种产物(如文档、架构图等)，用于描述软件架构，方便沟通与协作。下面重点讲述常见的软件架构过程及其产物。


## 4.1 软件架构之“what”

在我们决定要做一个新的架构设计前，无非以下两种状况：

 - 现有架构无法继续支撑现有业务(所谓的架构升级、演化)
 - 实现一套全新的软件系统(内在或者外在驱动)

不管是那种，在开始动手前，必须明确“核心需求、目标到底是什么”。之前我们提到过如下观点：
    
    接到要求和需求，至少问两个以上为什么，弄明白真正的核心目标/需求

对于工作五年以上的同学，几乎都遇到过这样的言论：“现在的系统各种问题，咱们重新设计一套新的架构替换了吧”。听到这样的说法，一定不要轻易去赞同和实施。原有的系统就算再烂，也是支撑业务往前走的，而且新设计的系统就一定好吗？如果没有充分掌握原有系统就去草率设计，也许连老系统都不如。

很多要求设计新架构的，多问几个“为什么”，也许只需要对原有系统的问题进行深入分析，部分优化就能解决，避免人力物力的浪费。“改善型问题”最后变成了解决“异常型问题”。

---

下面，我们回到真正的“改善型问题”，假设我们是业务后端开发人员，接到产品经理的需求，要做一款“滴滴加油”的产品（这个产品真的存在，就在滴滴车主端app里），按照上面说的，我们至少问两个为什么。

    PM：我们下一个要做的产品是“滴滴加油”
    程序猿：为什么
    PM：因为我们滴滴的司机有2000多万，他们都有加油的需求，而且是强需求。
    程序猿：司机为什么要用“滴滴加油”
    PM：因为我们有这么庞大的司机流量，可以和偏远加油站合作，以给他们引流为条件，拿到较低的加油折扣，把这些折扣让利给司机，司机用“滴滴加油”能得到优惠，自然愿意用
    程序猿：那我们为什么做这个产品，我们有什么好处
    PM：我们可以向加油站收取少许服务费用，量大了以后，可以深入渗透到加油全产业，想象空间无限大    

到了这里，我们可以说很清楚的明白了做"滴滴加油"这个产品的目的。需要注意的是，在问为什么的时候，一定要从“利益”这个角度去思考。

**划重点1：接到新的需求，至少问两个为什么，并且要从“利益”这个角度去思考，弄清楚真正的目的**

**划重点2：如果接到的需求是以前从没有接触过的领域，则不要着急去问为什么，遵照"学习的黄金圆环"，先去了解和熟悉，充分了解之后再问为什么**

---

## 4.2 软件架构之“who”与“how”

在“解决改善型问题”中，我们提到过如下观点：

    **可以采用“枚举法”列举核心目标实现过程中涉及到的所有“利益相关者”，并明确他们的“权责”以及“真正关注的利益点”(多思考多问为什么)**

“利益相关者”也就是我们这里说的“who”。

软件架构是非常大的话题，本章节不讲如何做架构，只尝试从“利益相关者”的角度来讲一下软件架构的“视图”，如果不妥之处，欢迎多多指正。

### RUP 4+1 视图
RUP在wiki上的定义如下：

    统一软件开发过程（英语：Rational Unified Process，缩写为RUP）是一种软件工程方法，为迭代式软件开发流程。最早由Rational Software公司开发，因此冠上公司名称。Rational Software公司后来被IBM并购，成为IBM之下的一个部门，因此又称IBM-Rational Unified Process。
    RUP描述了如何有效地利用商业的可靠的方法开发和部署软件，是一种重量级过程（也被称作厚方法学），因此特别适用于大型软件团队开发大型项目。    
   
如果读过《软件工程导论》《UML统一建模语言》这两本书籍，应该是对这个比较熟悉的。

1995年，Philippe Kruchten在《IEEE Software》上发表了题为《The 4+1 View Model of Architecture》的论文，引起了业界的极大关注，并最终被RUP采纳。如下这张图（在UML那本书里有）：


<img src="http://img.blog.csdn.net/20171013113843056?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveXVuX2ppYW5mZWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" width="50%" height="50%">

关于这几个视图的说明，书里也有详细的讲解。翻译成中文分别是：场景视图、逻辑视图、开发视图、进程视图、部署视图。

4+1视图在软件架构的过程中有很大的价值，下面会讲解如何在架构中利用4+1视图。

### 软件架构中的"利益相关者"

软件开发过程中，会涉及许多人员，例如：业务方，产品经理，客户/用户，开发经理，工程师，测试人员，运维人员，产品运营人员等等。这些人员都是"利益相关者"，做架构的时候，必须和这些利益相关者充分沟通，深入理解他们关注的"利益点"，以及他们的"权责"。

4+1视图可以对应不同的"利益相关者"，如下：

 - 场景视图：业务方、产品经理、客户/用户
 - 逻辑视图：开发经理、工程师等技术相关人员
 - 开发视图：开发经理、工程师等技术相关人员
 - 进程视图：工程师
 - 部署视图：工程师、运维人员

ps：和利益相关者沟通时，可以从"功能性"(如业务需求)与"非功能性"(如性能、稳定性、可用性等)两大方面去沟通。

### 软件架构中的视图

做架构的过程中，充分和"利益相关者"沟通，获取"关注利益点"(功能性&非功能性需求)以及"权责"。最后产出相应的文档或者架构图。

对应到4+1视图，如下：

 - 场景视图：    
  
    利益相关者：业务方、产品经理、客户/用户    
    架构产物：用例图、交互图等
 - 逻辑视图：    
     
    利益相关者： 开发经理、工程师等技术相关人员    
    架构产物：分层架构图，如常见的分层架构，业务层、领域层、基础服务层等(在技术分享中，我们最常见到的就是分层架构图)
 - 开发视图：    

    利益相关者：开发经理、工程师等技术相关人员     
    架构产物：序列图、状态图、类图等等     
 - 进程视图：      

    利益相关者：工程师       
    架构产物：代码架构图，如代码中具体的dao、service、controller、biz等    
 - 部署视图：    

    利益相关者：工程师、运维人员    
    架构产物：部署架构图，主要说明物理部署状况    

鉴于篇幅，这里不再详细介绍各种图，这些我们在工作中一定都遇到过，可以通过其他渠道了解。

# 5. 总结

总结一下，本文主要阐述了如下观点：
 - 架构是挖掘问题本质、解决问题的过程
 - 软件是人类社会中行为和现象的映射和载体，所有的软件都可以追溯到人类的实际行为
 - 康威定律: 设计系统的组织，其产生的设计(架构)等同于组织之内、组织之间的沟通结构
 - 软件的开发过程分为需求分析、概要设计、详细设计、编码、测试、上线。软件架构主要指前3个部分
 - 做架构前从“利益”的角度去思考，多问"为什么"，弄清"根本目的"。不熟悉的领域，利用"学习的黄金圆环"去熟悉
 - 利用4+1视图来对"利益相关者"分类，并产出相关视图


  [2]: http://www.infoq.com/cn/articles/an-informal-discussion-on-architecture-part01
  [4]: http://www.infoq.com/cn/articles/an-informal-discussion-on-architecture-part05
